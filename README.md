# π–¥οΈ simftp: Intelligent FTP Server & Client

**simftp**λ” κ°•λ ¥ν• λ³΄μ•κ³Ό μ§€λ¥ν• μλ™ν™” κΈ°λ¥μ„ κ°–μ¶ ν†µν•© FTP μ†”λ£¨μ…μ…λ‹λ‹¤. μ λ™ IP ν™κ²½μ—μ„μ λ²κ±°λ΅μ΄ κ΄€λ¦¬ μ—…λ¬΄λ¥Ό μλ™ν™”ν•κ³ , AES-256 κΈ°λ°μ κ°•λ ¥ν• λ³΄μ• μ²΄κ³„λ΅ μ†μ¤‘ν• λ°μ΄ν„°λ¥Ό λ³΄νΈν•©λ‹λ‹¤. λ‹¨μΌ μΈν„°νμ΄μ¤μ—μ„ μ„λ²„ μ μ–΄μ™€ ν΄λΌμ΄μ–ΈνΈ μ „μ†΅μ„ λ¨λ‘ μ™„λ²½ν•κ² μ²λ¦¬ν•  μ μμµλ‹λ‹¤.

---

## π“ μ‹μ¤ν… μ•„ν‚¤ν…μ² λ° λ°μ΄ν„° κµ¬μ΅°

### 1. μ§€λ¥ν• λ°μ΄ν„° μ—”ν‹°ν‹° κ΄€κ³„λ„ (ERD)
μ¤‘μ•™ μ§‘μ¤‘μ‹ `ConfigManager`κ°€ λ¨λ“  μ„¤μ •κ³Ό λ³΄μ• μμ‚°μ„ μƒλ€ κ²½λ΅ κΈ°λ°μΌλ΅ μ•μ „ν•κ² ν†µν•© κ΄€λ¦¬ν•©λ‹λ‹¤.

```mermaid
erDiagram
    CONFIG_MANAGER ||--|| SERVER_CONFIG_JSON : "μ…μ¶λ ¥/λ™κΈ°ν™”"
    CONFIG_MANAGER ||--o{ USERS_JSON : "κ³„μ •/κ¶ν• κ΄€λ¦¬"
    CONFIG_MANAGER ||--|| CLIENT_CONFIG_JSON : "μ ‘μ† νμ¤ν† λ¦¬"
    CONFIG_MANAGER ||--|| MASTER_KEY : "λ³΄μ• νμ΄λ΅λ“"
    CONFIG_MANAGER ||--|| SSL_CERT_SET : "FTPS μ•”νΈν™”"

    SERVER_CONFIG_JSON {
        int port "μ„λΉ„μ¤ ν¬νΈ(κΈ°λ³Έ 14729)"
        string root "κ³µμ  λ£¨νΈ λ””λ ‰ν† λ¦¬"
        bool nat "μ§€λ¥ν• NAT μ°ν μ„¤μ •"
        bool ftps "TLS/SSL λ³΄μ• λ¨λ“"
        bool scheduler "KST 00:01 μλ™ μ¬μ‹μ‘"
    }

    USERS_JSON {
        string id "Primary Key (Unique)"
        string pw "Encrypted (AES-256 Fernet)"
        string home "μ‚¬μ©μ κ²©λ¦¬ ν™ ν΄λ”"
        string perms "κ¶ν• μ„ΈνΈ (elradfmw)"
    }

    MASTER_KEY {
        binary secret "AES-256 Symmetric Key"
        path location "config/master.key"
    }

    SSL_CERT_SET {
        file public_crt "μ„λ²„ κ³µκ°ν‚¤ (server.crt)"
        file private_key "μ„λ²„ κ°μΈν‚¤ (server.key)"
        int validity "10λ…„ μλ™ κ°±μ‹ "
    }
```

### 2. NAT/κ³µμ κΈ° ν™κ²½ λ°μ΄ν„° νλ¦„ (Network Flow)
μ™Έλ¶€λ§ μ‚¬μ©μκ°€ μΈν„°λ„· κ³µμ κΈ°(Gateway)λ¥Ό κ±°μ³ λ‚΄λ¶€ PCλ΅ μ ‘μ†ν•λ” λ³µμ΅ν• λ‹¨κ³„λ¥Ό simftpκ°€ μ§€λ¥μ μΌλ΅ μ¤‘κ³„ν•©λ‹λ‹¤.

```mermaid
sequenceDiagram
    participant Client as μ™Έλ¶€ μ‚¬μ©μ (Remote)
    participant Router as μΈν„°λ„· κ³µμ κΈ° (NAT Gateway)
    participant simftp as simftp μ„λ²„ (My PC)

    Note over Client, simftp: π”µ Phase 1: λ…λ Ήμ–΄ μ μ–΄ μ±„λ„ (Port: 14729)
    Client->>Router: μ ‘μ† μ”μ²­ (κ³µμΈ IP μ…λ ¥)
    Router->>simftp: ν¬νΈ ν¬μ›λ”© κ·μΉ™μ— λ”°λΌ ν¨ν‚· μ¤‘κ³„
    simftp-->>Client: 220 simftp ready (μ ‘μ† μ„±κ³µ)

    Note over Client, simftp: πΆ Phase 2: μ§€λ¥ν• IP μ¶”μ  λ° λ°μ΄ν„° μ±„λ„
    simftp->>Router: ip.pe.kr API νΈμ¶ (ν”„λ΅μ‹ λ¬΄μ‹ PowerShell μ—”μ§„)
    Router-->>simftp: "ν„μ¬ κ³µμΈ IP μ‘λ‹µ"
    simftp->>Client: "λ°μ΄ν„° μ „μ†΅μ„ μ„ν• μλ™ ν¬νΈ μ •λ³΄ μ „λ‹¬"
    Client->>Router: λ°μ΄ν„° μ±„λ„ μ ‘μ† μ‹λ„
    Router->>simftp: λ°μ΄ν„° ν¨ν‚· μ¤‘κ³„
    simftp-->>Client: νμΌ λ©λ΅ λ° μ „μ†΅ λ°μ΄ν„° μ†΅μ¶ (μ„±κ³µ)
```

---

## π›΅οΈ λ©€ν‹° λ μ΄μ–΄ λ³΄μ• μ‹μ¤ν…

| λ³΄μ• κ³„μΈµ | κΈ°μ  μ‚¬μ–‘ | μ„¤λ… |
| :--- | :--- | :--- |
| **λΉ„λ°€λ²νΈ λ³΄μ•** | **AES-256 Symmetric** | `master.key`λ¥Ό ν†µν• μ–‘λ°©ν–¥ μ•”νΈν™”λ΅ λ³΄μ•μ„±κ³Ό κ΄€λ¦¬ νΈμμ„±μ„ λ™μ‹μ— ν™•λ³΄ν•©λ‹λ‹¤. |
| **μ „μ†΅ λ³΄μ•** | **TLS/SSL (FTPS)** | λ°μ΄ν„° κ°€λ΅μ±„κΈ°(Sniffing)λ¥Ό λ°©μ§€ν•λ” κ°•λ ¥ν• ν„°λ„λ§ μ „μ†΅μ„ μ§€μ›ν•©λ‹λ‹¤. |
| **μ ‘μ† μ μ–΄** | **Anti-Brute Force** | λ¬΄λ‹¨ μ ‘κ·Ό μ‹λ„ μ‹ κ°•μ  μ°¨λ‹¨ λ° λ™μ‹ μ ‘μ† μ ν•(IPλ‹Ή 5κ°)μ„ μν–‰ν•©λ‹λ‹¤. |
| **μ΄μ λ³΄μ•** | **3-Step Warning** | μ¤‘μ” μμ‚°(Key, Cert) λ° μ‹μ¤ν… μ¬μ‹μ‘ μ‹ 3λ‹¨κ³„ κ²½κ³ μ°½μΌλ΅ μ‹¤μλ¥Ό λ°©μ§€ν•©λ‹λ‹¤. |
| **λ¬΄κ²°μ„± μ μ§€** | **Auto-Keygen** | λ³΄μ• μμ‚° λ¶„μ‹¤ μ‹ μ‹μ¤ν…μ΄ μ¤μ¤λ΅ κ°μ§€ν•μ—¬ μ¦‰μ‹ μ¬μƒμ„±μ„ μ‹λ„ν•©λ‹λ‹¤. |

---

## β° μ§€λ¥ν• μλ™ν™” λ° μ μ–΄ (Automation & Control)

*   **π“… KST κΈ°λ° μ¬μ‹μ‘ μ¤μΌ€μ¤„λ¬**: ν•κµ­ ν‘μ¤€μ‹(UTC+9) κΈ°μ¤€ **λ§¤μΌ μƒλ²½ 00:01**μ— μ„λ²„λ¥Ό μλ™μΌλ΅ μ¬μ‹μ‘ν•μ—¬ μ•μ •μ„±μ„ μ μ§€ν•©λ‹λ‹¤.
*   **β™»οΈ μ‹¤μ‹κ°„ μ—”μ§„ μ μ–΄ λ„κµ¬**: μ„λ²„ κµ¬λ™ μ¤‘μ—λ„ μ¦‰μ‹ μ—”μ§„λ§ μ¬μ‹μ‘ν•κ±°λ‚, μ• ν”λ¦¬μΌ€μ΄μ… ν”„λ΅μ„Έμ¤ μμ²΄λ¥Ό μ¬λ¶€ν…ν•μ—¬ μ„¤μ •μ„ μ™„λ²½ν λ°μν•  μ μμµλ‹λ‹¤.
*   **π“΅ ip.pe.kr κ³ μ‹ λΆ°λ„ κ³µμΈ IP μ¶”μ **: PowerShellμ **`GlobalProxySelection`** κΈ°μ μ„ ν†µν•΄ ν”„λ΅μ‹ κ°„μ„­μ„ μ°¨λ‹¨ν•κ³  μ‹¤μ  κ³µμΈ IPλ¥Ό κ°μ§€ν•©λ‹λ‹¤.
*   **π  ipconfig κΈ°λ° λ΅μ»¬ IP μ •λ°€ κ°μ§€**: μ‹μ¤ν… λ…λ Ήμ–΄λ¥Ό μ§μ ‘ νμ‹±ν•μ—¬ ν„μ¬ ν™μ„±ν™”λ μ‹¤μ  λ„¤νΈμ›ν¬ μ–΄λ‘ν„°μ λ‚΄λ¶€ μ£Όμ†λ¥Ό μ •ν™•ν μ¶”μ¶ν•©λ‹λ‹¤.
*   **β³ λ“€μ–Ό λ΅λ”© ν”Όλ“λ°± μ‹μ¤ν…**: λ¨λ“  IP μ΅°ν κ³Όμ •μ—μ„ "λ΅λ”© μ¤‘..." μƒνƒλ¥Ό ν‘μ‹ν•μ—¬ μ‚¬μ©μμ—κ² μ§„ν–‰ μƒν™©μ„ ν¬λ…ν•κ² μ „λ‹¬ν•©λ‹λ‹¤.

---

## π¨ μ‚¬μ©μ μΈν„°νμ΄μ¤ λ° κ²½ν— (UI/UX)

*   **π” κ³ λ€λΉ„ λ΅κ·Έ λ¨λ‹ν„°λ§ (Dark Mode)**: μ‹μ¤ν… κ°€λ™ λ΅κ·Έλ¥Ό λ‹¤ν¬ ν…λ§λ΅ λ””μμΈν•μ—¬ μ¤‘μ”ν• μ΄λ²¤νΈ(μ ‘μ†, μ¤λ¥)λ¥Ό μ‹κ°μ μΌλ΅ κ°•μ΅°ν•λ©° μ¥μ‹κ°„ λ¨λ‹ν„°λ§ μ‹ μ‹λ ¥μ„ λ³΄νΈν•©λ‹λ‹¤.
*   **π“ ν™©κΈ κ°€μ¤‘μΉ λ μ΄μ•„μ›ƒ**: ν•µμ‹¬ μ„¤μ • μμ—­κ³Ό μ‹¤μ‹κ°„ λ΅κ·Έ μμ—­μ λΉ„μ¨μ„ `3:4`λ΅ μ •λ°€ μ΅°μ •ν•μ—¬, μ •λ³΄ κ³Όμ‰ μ—†μ΄ λ¨λ“  μ»¨νΈλ΅¤λ¬κ°€ ν•λμ— λ“¤μ–΄μ¤λ” μΎμ ν• μ‘μ—… ν™κ²½μ„ μ κ³µν•©λ‹λ‹¤.
*   **π λ„¤νΈμ›ν¬ λ€μ‹λ³΄λ“ (Side-by-Side)**: λ΅μ»¬(Blue)κ³Ό κ³µμΈ(Red) IPλ¥Ό μƒμ§•μ μΈ μ»¬λ¬μ™€ ν•¨κ» λ‚λ€ν•κ² λ°°μΉν•μ—¬, λ‚΄λ¶€λ§ μ—°κ²° λ° ν¬νΈ ν¬μ›λ”© μƒνƒλ¥Ό μ¦‰κ°μ μΌλ΅ μ§„λ‹¨ν•  μ μμµλ‹λ‹¤.
*   **π’Ύ μ›μ¤ν†± μΈλΌμΈ νΈμ§‘κΈ°**: λ³µμ΅ν• μ„¤μ •μ°½ μ „ν™ μ—†μ΄ κ³„μ • μƒμ„±, κ¶ν• λ¶€μ—¬, κ²½λ΅ ν• λ‹Ήμ„ ν• μ¤„μ μΈν„°νμ΄μ¤μ—μ„ λλ‚΄λ” μ§κ΄€μ μΈ μ›ν¬ν”λ΅μ°λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤.

---

## π ν¬νΈ ν¬μ›λ”© ν•„μ μ„¤μ •

μ λ™ IP/NAT ν™κ²½μ—μ„ μ™Έλ¶€ μ ‘μ†μ„ μ„ν•΄ κ³µμ κΈ° κ΄€λ¦¬ νμ΄μ§€(`192.168.45.1`)μ— λ°λ“μ‹ λ“±λ΅ν•΄μ•Ό ν•λ” ν•„μ κ·μΉ™μ…λ‹λ‹¤.

| ν•­λ© | ν”„λ΅ν† μ½ | μ™Έλ¶€/λ‚΄λ¶€ ν¬νΈ | λ€μƒ λ‚΄λ¶€ IP | μ„¤λ… |
| :--- | :--- | :--- | :--- | :--- |
| **FTP μ»¤λ§¨λ“** | TCP | **14729** | `192.168.45.61` | μ ‘μ† λ° λ…λ Ήμ–΄ μ „μ†΅μ© |
| **Passive λ°μ΄ν„°** | TCP | **60000 ~ 60100** | `192.168.45.61` | νμΌ μ „μ†΅ λ° λ©λ΅ ν‘μ‹ (ν•„μ) |

---

## π“‚ ν”„λ΅μ νΈ μƒμ„Έ κµ¬μ΅°

| κ²½λ΅ | κµ¬λ¶„ | νμΌ/λ””λ ‰ν† λ¦¬ λ… | νΉμ§•/λ©μ  |
| :---: | :---: | :--- | :--- |
| π“ | **Source** | `src/` | ν”„λ΅κ·Έλ¨μ λ¨λ“  μ‹¤ν–‰ μ†μ¤ μ½”λ“ |
| π“„ | Entry | `src/main.py` | ν”„λ΅κ·Έλ¨μ μ‹μ‘μ  λ° μ‹μ¤ν… μ΄κΈ°ν™” |
| π“„ | Frame | `src/app.py` | UI νƒ­ μ‹μ¤ν… λ° λ©”μΈ λ£¨ν”„ κ΄€λ¦¬ |
| π“ | **Core** | `src/core/` | μ„¤μ •, λ³΄μ• μ ν‹Έ, IP μ΅°ν μ—”μ§„ |
| π“ | **UI** | `src/gui/tabs/` | μ„λ²„ μ μ–΄, ν΄λΌμ΄μ–ΈνΈ, λ³΄μ• μ„¤μ • κ° νƒ­ μ»΄ν¬λ„νΈ |
| π“ | **Data** | `config/` | **.gitignore μ μ™Έ λ€μƒ** (μ‚¬μ©μ λ°μ΄ν„°, λ³΄μ•ν‚¤, μΈμ¦μ„) |
| π“„ | Config | `config/*.json` | μ„λΉ„μ¤ μ„¤μ • λ° μ‚¬μ©μ κ³„μ • μ •λ³΄ |
| π“„ | Key | `config/master.key` | λ¨λ“  λ³΄μ•μ ν•µμ‹¬ (μ•”νΈν™”μ© λ€μΉ­ν‚¤) |
| π“„ | Script | `run.bat` | ν™κ²½ λ³€μ μ²΄ν¬ λ° μ›ν΄λ¦­ μ‹¤ν–‰ μ¤ν¬λ¦½νΈ |

---

## π€ μ‹μ‘ν•κΈ°

1. **μ„¤μΉ λ° μ‹¤ν–‰**: `run.bat` νμΌμ„ μ‹¤ν–‰ν•λ©΄ ν•„μ”ν• λΌμ΄λΈλ¬λ¦¬ μ²΄ν¬ ν›„ μλ™μΌλ΅ ν”„λ΅κ·Έλ¨μ΄ μΌμ§‘λ‹λ‹¤.
2. **μ²« μ„λ²„ κ°€λ™**: **Server νƒ­**μ—μ„ μ μ €λ¥Ό μ¶”κ°€ν•κ³  `Start Server` λ²„νΌμ„ λ„λ¥΄μ„Έμ”.
3. **λ³΄μ• μ„¤μ •**: **μ„¤μ • νƒ­**μ—μ„ λ§¤μΌ μƒλ²½ μλ™ μ¬μ‹μ‘ κΈ°λ¥μ΄ μΌμ Έ μλ”μ§€ ν™•μΈν•μ„Έμ”. (κΈ°λ³Έ ν™μ„±ν™”)
4. **μ™Έλ¶€ μ ‘μ†**: ν•Έλ“ν° LTEλ¥Ό μΌκ³  ν™”λ©΄μ— ν‘μ‹λ **κ³µμΈ IP(.199)**λ¥Ό μ…λ ¥ν•μ—¬ μ ‘μ† ν…μ¤νΈλ¥Ό μ§„ν–‰ν•μ„Έμ”.
